# WAF检测规则完善任务

## 任务概述
完善OpenResty WAF的检测规则，增加新的攻击检测类型并增强现有较弱规则。

## 执行计划

### 1. 新增规则文件
- [x] `upload.lua` - 文件上传检测（13条规则）
- [x] `nosql.lua` - NoSQL注入检测（13条规则）
- [x] `ssti.lua` - SSTI模板注入检测（16条规则）
- [x] `deserialize.lua` - 反序列化攻击检测（18条规则）

### 2. 增强现有规则
- [x] `path.lua` - 从2条增强到12条规则
- [x] `ssrf.lua` - 从1条增强到10条规则
- [x] `bot.lua` - 从1条增强到8条规则

### 3. 更新配置文件
- [x] `waf.conf` - 添加4个新规则开关

## 规则覆盖情况

| 规则类型 | 原有规则数 | 现有规则数 | 覆盖范围 |
|---------|-----------|-----------|---------|
| backup | 3 | 3 | 备份文件检测 |
| bot | 1 | 8 | 恶意爬虫/扫描器 |
| cmd | 12 | 12 | 命令注入 |
| deserialize | 0 | 18 | 反序列化攻击（新增） |
| dns | 4 | 4 | DNSLog检测 |
| ldap | 3 | 3 | LDAP/JNDI注入 |
| nosql | 0 | 13 | NoSQL注入（新增） |
| path | 2 | 12 | 路径遍历 |
| sensitive | 4 | 4 | 敏感文件暴露 |
| spring | 6 | 6 | Spring Boot检测 |
| sqli | 11 | 11 | SQL注入 |
| ssrf | 1 | 10 | SSRF攻击 |
| ssti | 0 | 16 | 模板注入（新增） |
| upload | 0 | 13 | 文件上传（新增） |
| xss | 12 | 12 | XSS攻击 |
| xxe | 4 | 4 | XXE攻击 |

## 总计
- **原有规则总数**: 63条
- **现有规则总数**: 144条
- **新增规则**: 81条

## 注意事项
1. 需要重启OpenResty使配置生效
2. 建议先在测试环境验证规则，避免误报
3. 可根据实际业务调整各规则的置信度(confidence)
