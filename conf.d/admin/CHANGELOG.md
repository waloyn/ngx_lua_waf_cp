# 更新日志

## [2.0.0] - 2024-11-08

### 🎉 重大更新 - 管理后台完全重构

#### ✨ 新特性

**全新设计**
- 采用现代化紫色渐变主题 (#667eea → #764ba2)
- 卡片式布局，圆角阴影设计
- 响应式设计，支持移动端
- 平滑过渡动画和交互效果

**单页应用架构**
- 客户端路由，无刷新页面切换
- 模块化代码结构
- 统一的 API 请求封装
- 全局状态管理

**零依赖实现**
- 纯原生 HTML5 + CSS3 + JavaScript
- 无需任何框架或库
- 代码体积小，加载快速
- 易于维护和扩展

#### 🔧 功能模块

**1. 登录页面**
- 渐变背景设计
- 表单验证
- 记住我功能
- 会话管理

**2. 仪表盘**
- 实时统计数据展示
- Canvas 绘制攻击类型图表
- 统计卡片（总请求、拦截请求、拦截率、系统状态）
- 自动刷新（30秒间隔）

**3. 规则管理**
- 规则列表展示
- 启用/禁用规则（Toggle Switch）
- 查看规则详细内容
- 重载配置功能
- 规则状态实时更新

**4. IP 管理**
- 白名单管理（添加/删除）
- 黑名单管理（添加/删除）
- 双列布局展示
- 支持 CIDR 格式

**5. 攻击日志**
- 按域名和日期查询
- 日志列表展示
- 查看日志详情（JSON 格式）
- 分页加载

**6. 系统设置**
- 在线编辑配置文件
- 语法高亮（Monospace 字体）
- 保存配置
- 重载配置

#### 🐛 Bug 修复

**规则管理问题**
- ✅ 修复规则列表无法加载的问题
- ✅ 修复 API 返回对象格式导致的错误
- ✅ 优化规则文件读取逻辑
- ✅ 添加错误处理和降级方案

**系统设置问题**
- ✅ 修复配置文件无法加载的问题
- ✅ 修复文件路径参数错误
- ✅ 添加 waf.conf 到文件白名单
- ✅ 优化文件读写权限检查

**API 响应问题**
- ✅ 统一 API 响应格式
- ✅ 兼容多种响应结构
- ✅ 改进错误消息提示
- ✅ 添加请求日志记录

**布局问题**
- ✅ 修复卡片头部按钮位置
- ✅ 添加 flex-between 工具类
- ✅ 优化响应式布局
- ✅ 修复移动端显示问题

#### 🎨 UI/UX 改进

**视觉设计**
- 统一的配色方案
- 清晰的视觉层次
- 优雅的阴影效果
- 渐变色按钮

**交互设计**
- 悬停状态反馈
- 点击动画效果
- 表单焦点高亮
- Toast 通知提示

**组件库**
- 按钮（主要、次要、成功、危险）
- 徽章（成功、警告、危险、信息）
- 开关（Toggle Switch）
- 表格（斑马纹、悬停高亮）
- 卡片（头部、主体、底部）
- 模态弹窗
- 加载动画

#### 🛠️ 开发工具

**调试工具**
- `debug.html` - API 接口测试工具
- `check.html` - 系统自动检查工具
- `test-layout.html` - 布局测试页面

**文档**
- `README.md` - 使用说明
- `TROUBLESHOOTING.md` - 故障排查指南
- `CHANGELOG.md` - 更新日志

#### 📦 文件结构

```
conf.d/admin/
├── index.html              # 主应用页面
├── login.html              # 登录页面
├── styles.css              # 全局样式（500行）
├── app.js                  # 主应用逻辑（700行）
├── login.js                # 登录逻辑（50行）
├── debug.html              # API 调试工具
├── check.html              # 系统检查工具
├── test-layout.html        # 布局测试页面
├── README.md               # 使用说明
├── TROUBLESHOOTING.md      # 故障排查
└── CHANGELOG.md            # 更新日志
```

#### 🔄 后端 API 更新

**utils/api.lua**
- 优化 `getRules()` 函数，使用 Windows dir 命令
- 修复 `readFile()` 函数，添加 waf.conf 支持
- 修复 `saveFile()` 函数，添加 waf.conf 支持
- 改进错误处理和日志记录

**utils/router.lua**
- 优化错误消息返回
- 统一响应格式
- 添加详细的错误信息

#### 📊 性能优化

- 最小化 DOM 操作
- 事件委托
- 按需加载数据
- Canvas 图表绘制（无需图表库）
- 异步数据加载
- 请求缓存

#### 🔒 安全改进

- CSRF 防护（Cookie HttpOnly）
- XSS 防护（内容转义）
- 会话超时自动跳转
- API 请求统一拦截
- 文件访问白名单

#### 🌐 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

#### 📝 使用说明

**访问地址**
```
主应用: http://localhost:9520/
登录页: http://localhost:9520/login.html
调试工具: http://localhost:9520/debug.html
系统检查: http://localhost:9520/check.html
布局测试: http://localhost:9520/test-layout.html
```

**快速开始**
1. 访问 `http://localhost:9520/check.html` 检查系统状态
2. 访问 `http://localhost:9520/login.html` 登录
3. 开始使用管理后台

#### 🙏 致谢

感谢所有测试和反馈的用户！

---

## [1.0.0] - 之前版本

### 初始版本
- 基础的管理后台功能
- 多页面架构
- 基础的 UI 设计

---

## 未来计划

### 待开发功能
- [ ] 暗黑模式
- [ ] 多语言支持
- [ ] 更多图表类型
- [ ] 导出报表功能
- [ ] 实时 WebSocket 通知
- [ ] 用户权限管理
- [ ] 操作审计日志
- [ ] 自定义主题配置

### 性能优化
- [ ] 虚拟滚动（大数据列表）
- [ ] Service Worker（离线支持）
- [ ] 资源预加载
- [ ] 代码分割

### 体验优化
- [ ] 键盘快捷键
- [ ] 拖拽排序
- [ ] 批量操作
- [ ] 搜索过滤
- [ ] 数据导入导出
