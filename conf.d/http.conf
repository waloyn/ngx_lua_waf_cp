lua_shared_dict nova_waf 50m;
lua_shared_dict nova_waf_count 10m;
lua_shared_dict dict_locks 5m;
lua_shared_dict sessions 1m;
lua_package_path "e:/website/openresty/waf/?.lua;;";
lua_package_cpath "e:/website/openresty/waf/?.so;;";

init_by_lua_file "e:/website/openresty/waf/init.lua";
access_by_lua_file "e:/website/openresty/waf/waf.lua";
header_filter_by_lua_file "e:/website/openresty/waf/header.lua";
exit_worker_by_lua_file   "e:/website/openresty/waf/exit.lua";
# 真实ip获取
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Real-Port $remote_port;
proxy_set_header X-Forwarded-For $remote_addr;

# WAF管理控制台配置
server {
    listen 9520;
    server_name localhost;
    charset utf-8;
     
    # 静态文件目录
    location / {
        root e:/website/openresty/waf/conf.d/admin;
        index index.html;
        try_files $uri $uri/ /;
    }
    
    # API路由
    location /api/ {
        content_by_lua_block {
            require("utils.router").handle()
        }
    }
    
    # 安全headers
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";
    
    # 错误页面
    error_page 403 /403.html;
    location = /403.html {
        root conf.d;
        internal;
    }
}